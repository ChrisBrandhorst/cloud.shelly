<script type="text/javascript">
  try {
    Homey.emit('add_device', {})
      .then(result => {
        var i;
        for (i = 0; i < 5; i++) {
          var deviceid = i + 1;
          if (i < 4) {
            if (i === 0) {
              var capabilities = [
                "onoff",
                "measure_power",
                "meter_power",
                "measure_voltage",
                "input_1",
                "measure_temperature"
              ]
            } else {
              var capabilities = [
                "onoff",
                "measure_power",
                "meter_power",
                "measure_voltage",
                "input_1"
              ]
            }
            Homey.createDevice({
              name: 'Shelly 4 Pro ' + deviceid,
      				data: {
                id: result.data.id + '-channel-' + i
              },
      				settings: {
                server_address: result.settings.server_address,
                cloud_device_id: result.settings.cloud_device_id
              },
              capabilities: capabilities,
              store: {
                main_device: result.data.id,
                channel: i,
                type: result.store.type,
                battery: result.store.battery,
                unicast: result.store.unicast,
                sdk: 3,
                communication: result.store.communication
              }
      			});
          } else {
            Homey.done()
          }
    		}
      })
  } catch (error) {
    Homey.alert(error);
    Homey.done();
  }
</script>
