<script type="text/javascript">

Homey.setTitle(Homey.__('pair.title_cloud_pairing'));

$(function() {
  Homey.emit('get_integrator_url')
    .then(result => {
      if (result) {
        $('.integrator-link').html('<a href="'+ result +'" target="_blank">link</a>');
      } else {
        $('.shelly-error').show();
        $('.shelly-error-msg').html(Homey.__('pair.no_integrator_url'));
      }
    })
    .catch(error => {
      $('.shelly-error').show();
      $('.shelly-error-msg').html(error);
    });

  $('#test-connection').click(function() {
		$('.shelly-test').hide();
		$('.shelly-ok').hide();
		$('.shelly-error').hide();
		$('.shelly-info').hide();

    Homey.emit('test_connection')
      .then(result => {
        var shellyinfo = "<div class='info-row'><span class='info-label' data-i18n='pair.device'>Shelly Device:</span><span class='info-value'> "+ result.name[0] +"</span></div><div class='info-row'><span class='info-label' data-i18n='pair.deviceid'>Shelly Device ID:</span><span class='info-value'> "+ result.deviceId +"</span></div>";
        $('.shelly-info').show();
        $('.shelly-info').html(shellyinfo);
        $('.shelly-test').show();
        $('#connect').prop('disabled', false);
      })
      .catch(error => {
        $('.shelly-error').show();
				$('.shelly-error-msg').html(error);
      });
	});

  $('#connect').click(function() {
    Homey.showView('add_device');
	});

});
</script>

<style type="text/css">
  .form-group {
    width: 100%;
    display: block;
    margin-bottom: 12px;
  }
  .form-group label {
    display: block;
  }
  .shelly-status, .shelly-info {
		display: none;
	}
  .shelly-info {
    margin-top: 10px;
    font-size: 12px;
  }
  .shelly-info .info-row {
    min-width: 150px;
    padding-bottom: 4px;
  }
  .shelly-info .info-label {
    display: inline-block;
    min-width: 100px;
    font-weight: 700;
  }
  .buttons, .messages {
    padding-top: 14px;
  }
  .button:disabled {
    color: #ccc;
  }
  .button:enabled {
    background-color: #00c139 !important;
    color: #fff;
  }
</style>

<p data-i18n="pair.instructions_cloud_pairing" class="introtext">You are about to pair a Shelly device over the cloud. Please follow these steps:</p>
<ol>
  <li><span data-i18n="pair.instructions_cloud_pairing_step_1">Visit the Shelly Integrator Portal using this</span> <span class="integrator-link"></span>.</li>
  <li data-i18n="pair.instructions_cloud_pairing_step_2">Log into this portal with your Shelly cloud credentials.</li>
  <li data-i18n="pair.instructions_cloud_pairing_step_3">Find the device you wish to pair making sure it's of the same model which you are currently pairing in Homey (if your device is not listed here you will have to enable the cloud connection through the device webinterface of the Shelly smartphone app first).</li>
  <li data-i18n="pair.instructions_cloud_pairing_step_4">In the Shelly Integrator Portal click the device you wish to pair and enable the cloud integrator and control settings for that device.</li>
  <li data-i18n="pair.instructions_cloud_pairing_step_5">Click save in the Shelly Integrator Portal and afterwards click next button in this pairing wizard.</li>
  <li data-i18n="pair.instructions_cloud_pairing_step_5">Click save in the Shelly Integrator Portal and click next button in this pairing wizard.</li>
  <li data-i18n="pair.instructions_cloud_pairing_step_6">If you see the correct device ID shown below you can click the next button to continu pairing the device.</li>
</ol>

<div class="shelly-pairing">
	<div class="form-group buttons">
		<button id="test-connection" class="button" data-i18n="pair.test">Test Connection</button>
		<button id="connect" class="button" data-i18n="pair.connect" disabled>Connect</button>
	</div>
</div>

<div class="shelly-info"></div>

<div class="messages">
	<p class="shelly-status shelly-test" style="color: #008C23;"><i class="fa fa-check"></i> <span class="shelly-test-msg" data-i18n="pair.testing">Connection test succesfull</span></p>
	<p class="shelly-status shelly-ok" style="color: #008C23;"><i class="fa fa-check"></i> <span class="shelly-ok-msg" data-i18n="pair.success">Shelly device added succesfully</span></p>
	<p class="shelly-status shelly-error" style="color: #ff6300;"><i class="fa fa-times"></i> <span class="shelly-error-msg"></span></p>
</div>
