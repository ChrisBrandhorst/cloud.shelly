<script type="text/javascript">
  Homey.emit('add_device', null, function(error, result) {
    if (error) {
      Homey.alert(error, null, function() {
        Homey.done()
    	});
    } else {
      var i;
      for (i = 0; i < 3; i++) {
        var deviceid = i + 1;
        if (i < 2) {
    			Homey.createDevice({
    				name: 'Shelly EM ' + deviceid,
    				data: {
              id: result.data.id + '-channel-' + i
            },
    				settings: {
              server_address: result.settings.server_address,
              cloud_device_id: result.settings.cloud_device_id
            },
            store: {
              main_device: result.data.id,
              channel: i,
              type: result.store.type,
              battery: result.store.battery,
              unicast: result.store.unicast,
              sdk: 3,
              communication: result.store.communication
            }
    			}, function(error, result ) {
    				if (error) {
              Homey.alert(error, null, function() {
                Homey.done();
            	});
    				}
    			})
        } else {
          Homey.done();
        }
  		}
    }
  })
</script>
